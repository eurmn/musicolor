import{S as Y,i as Z,s as $,e as q,t as g,c as A,a as M,g as b,d as u,b as w,f as j,I as h,h as B,j as P,k as F,K as ee,l as T,L,J as U,M as z,N as te,O as G}from"../chunks/vendor-d8275c28.js";function Q(r){let e,t;return{c(){e=q("span"),t=g("your musicolor is:"),this.h()},l(a){e=A(a,"SPAN",{class:!0});var n=M(e);t=b(n,"your musicolor is:"),n.forEach(u),this.h()},h(){w(e,"class","text-3xl text-center font-tw drop-shadow mb-2 svelte-lqbjo3")},m(a,n){j(a,e,n),h(e,t)},d(a){a&&u(e)}}}function se(r){let e,t,a,n,s;return{c(){e=q("a"),t=g("log in with "),a=q("span"),n=g("spotify"),s=g(` to see
      your musicolors :)`),this.h()},l(f){e=A(f,"A",{href:!0,target:!0,class:!0,style:!0});var o=M(e);t=b(o,"log in with "),a=A(o,"SPAN",{class:!0});var m=M(a);n=b(m,"spotify"),m.forEach(u),s=b(o,` to see
      your musicolors :)`),o.forEach(u),this.h()},h(){w(a,"class","group-hover:text-green-600 group-hover:font-bold"),w(e,"href",r[5]),w(e,"target","_blank"),w(e,"class","cursor-pointer text-xl text-center font-tw group svelte-lqbjo3"),L(e,"width","33vh")},m(f,o){j(f,e,o),h(e,t),h(e,a),h(a,n),h(e,s)},p(f,o){o&32&&w(e,"href",f[5])},d(f){f&&u(e)}}}function le(r){let e,t=r[2].color+"",a;return{c(){e=q("span"),a=g(t),this.h()},l(n){e=A(n,"SPAN",{class:!0});var s=M(e);a=b(s,t),s.forEach(u),this.h()},h(){w(e,"class","text-2xl text-center font-tw svelte-lqbjo3")},m(n,s){j(n,e,s),h(e,a)},p(n,s){s&4&&t!==(t=n[2].color+"")&&B(a,t)},d(n){n&&u(e)}}}function ae(r){let e,t;return{c(){e=q("span"),t=g("loading... wait a minute <3")},l(a){e=A(a,"SPAN",{});var n=M(e);t=b(n,"loading... wait a minute <3"),n.forEach(u)},m(a,n){j(a,e,n),h(e,t)},p:U,d(a){a&&u(e)}}}function W(r){let e,t,a=r[3].dancable+"",n,s,f=r[3].energetic+"",o,m,_=r[3].happiness+"",k,v;return{c(){e=q("span"),t=g("your style is "),n=g(a),s=g(", "),o=g(f),m=g(" and "),k=g(_),v=g(" :)."),this.h()},l(i){e=A(i,"SPAN",{class:!0});var c=M(e);t=b(c,"your style is "),n=b(c,a),s=b(c,", "),o=b(c,f),m=b(c," and "),k=b(c,_),v=b(c," :)."),c.forEach(u),this.h()},h(){w(e,"class","absolute bottom-5 w-full text-center")},m(i,c){j(i,e,c),h(e,t),h(e,n),h(e,s),h(e,o),h(e,m),h(e,k),h(e,v)},p(i,c){c&8&&a!==(a=i[3].dancable+"")&&B(n,a),c&8&&f!==(f=i[3].energetic+"")&&B(o,f),c&8&&_!==(_=i[3].happiness+"")&&B(k,_)},d(i){i&&u(e)}}}function ne(r){let e,t,a,n,s,f,o,m,_,k,v,i=r[2]&&Q();function c(l,p){return l[4]?ae:l[0]?le:se}let E=c(r),y=E(r),d=r[3]&&W(r);return{c(){e=P(),t=q("h1"),a=g("musicolor"),n=P(),s=q("main"),i&&i.c(),f=P(),o=q("div"),_=P(),y.c(),k=P(),d&&d.c(),v=F(),this.h()},l(l){ee('[data-svelte="svelte-7uar8o"]',document.head).forEach(u),e=T(l),t=A(l,"H1",{class:!0});var x=M(t);a=b(x,"musicolor"),x.forEach(u),n=T(l),s=A(l,"MAIN",{class:!0});var I=M(s);i&&i.l(I),f=T(I),o=A(I,"DIV",{class:!0,style:!0}),M(o).forEach(u),_=T(I),y.l(I),I.forEach(u),k=T(l),d&&d.l(l),v=F(),this.h()},h(){document.title="musicolor",w(t,"class","text-3xl m-5 self-start justify-self-start absolute"),w(o,"class",m="rounded-lg shadow-lg aspect-square"+(r[0]?"":" frame")+" svelte-lqbjo3"),L(o,"width","33vh"),L(o,"background",r[2]?`linear-gradient(238deg, ${r[2].color}, ${r[2].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),w(s,"class","w-full h-full flex flex-col justify-center items-center")},m(l,p){j(l,e,p),j(l,t,p),h(t,a),j(l,n,p),j(l,s,p),i&&i.m(s,null),h(s,f),h(s,o),r[6](o),h(s,_),y.m(s,null),j(l,k,p),d&&d.m(l,p),j(l,v,p)},p(l,[p]){l[2]?i||(i=Q(),i.c(),i.m(s,f)):i&&(i.d(1),i=null),p&1&&m!==(m="rounded-lg shadow-lg aspect-square"+(l[0]?"":" frame")+" svelte-lqbjo3")&&w(o,"class",m),p&4&&L(o,"background",l[2]?`linear-gradient(238deg, ${l[2].color}, ${l[2].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),E===(E=c(l))&&y?y.p(l,p):(y.d(1),y=E(l),y&&(y.c(),y.m(s,null))),l[3]?d?d.p(l,p):(d=W(l),d.c(),d.m(v.parentNode,v)):d&&(d.d(1),d=null)},i:U,o:U,d(l){l&&u(e),l&&u(t),l&&u(n),l&&u(s),i&&i.d(),r[6](null),y.d(),l&&u(k),d&&d.d(l),l&&u(v)}}}function X(r,e,t){t/=100;const a=e*Math.min(t,1-t)/100,n=s=>{const f=(s+r/30)%12,o=t-a*Math.max(Math.min(f-3,9-f,1),-1);return Math.round(255*o).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}function oe(r,e,t){let a,n,s,f=!1,o,m=!1,_="https://accounts.spotify.com/authorize";_+="?response_type=token",_+="&client_id="+encodeURIComponent("e069de3022af4a738e103dfa452c80a2"),_+="&scope=user-top-read",_+="&redirect_uri="+encodeURIComponent("http://localhost:3000/callback");function k(){let c=localStorage.getItem("token"),E=localStorage.getItem("expireTime");c&&E&&(console.log(Date.now(),parseInt(z.Buffer.from(E,"base64").toString())),Date.now()>parseInt(z.Buffer.from(E,"base64").toString())?localStorage.clear():(o=z.Buffer.from(c,"base64").toString(),t(0,f=!0)))}async function v(){return new Promise((c,E)=>{G.get("https://api.spotify.com/v1/me/top/tracks?limit=25&time_range=short_term",{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}}).then(y=>{let d=y.data.items.map(l=>l.id);G.get(`https://api.spotify.com/v1/audio-features?ids=${d.join(",")}`,{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}}).then(l=>{let p=l.data.audio_features,x=p.map(S=>S.danceability),I=x.reduce((S,C)=>S+C,0)/x.length,D=p.map(S=>1-S.valence),R=D.reduce((S,C)=>S+C,0)/D.length;t(3,s={dancable:"",energetic:"",happiness:""});let N;I>.5&&R<.5?(N={min:40,max:115},t(3,s.dancable="dancable",s),t(3,s.happiness="happy",s)):I>.5&&R>.5?(t(3,s.dancable="dancable",s),t(3,s.happiness="emotional",s),N={min:180,max:270}):(t(3,s.dancable="calming",s),t(3,s.happiness="emotional",s),N={min:0,max:30});let H=p.map(S=>S.energy),J=H.reduce((S,C)=>S+C,0)/H.length;J>=.5?t(3,s.energetic="energetic",s):t(3,s.energetic="relaxing",s);let K=Math.round(J*(N.max-N.min)+N.min),O=Math.round(I*100),V=Math.round((1-R)*100);c({color:X(K,O,V),gradient:X(K,O,V*.4)})})})})}k(),window.addEventListener("storage",k);function i(c){te[c?"unshift":"push"](()=>{a=c,t(1,a)})}return r.$$.update=()=>{r.$$.dirty&1&&f&&(t(4,m=!0),v().then(c=>{t(2,n=c),t(4,m=!1)}))},[f,a,n,s,m,_,i]}class ie extends Y{constructor(e){super();Z(this,e,oe,ne,$,{})}}export{ie as default};
