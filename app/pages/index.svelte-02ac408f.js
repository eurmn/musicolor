import{S as $,i as ee,s as te,e as z,t as w,c as C,a as N,g as k,d as h,b as S,f as A,I as _,h as B,j as R,k as O,K as le,l as U,L as q,J as V,M as se,N as D,O as F}from"../chunks/vendor-1ac4ce2c.js";function G(o,e,t){const a=o.slice();return a[9]=e[t],a[11]=t,a}function Q(o){let e,t;return{c(){e=z("span"),t=w("your musicolor is:"),this.h()},l(a){e=C(a,"SPAN",{class:!0});var l=N(e);t=k(l,"your musicolor is:"),l.forEach(h),this.h()},h(){S(e,"class","text-3xl text-center font-tw drop-shadow mb-2 svelte-efzwv")},m(a,l){A(a,e,l),_(e,t)},d(a){a&&h(e)}}}function W(o){let e,t=o[9]+"",a,l;return{c(){e=z("span"),a=w(t),this.h()},l(n){e=C(n,"SPAN",{class:!0});var r=N(e);a=k(r,t),r.forEach(h),this.h()},h(){S(e,"class",l="text-2xl w-full opacity-20 text-white block "+(o[11]%2==0?"text-left":"text-right"))},m(n,r){A(n,e,r),_(e,a)},p(n,r){r&8&&t!==(t=n[9]+"")&&B(a,t)},d(n){n&&h(e)}}}function ae(o){let e,t,a,l,n;return{c(){e=z("a"),t=w("log in with "),a=z("span"),l=w("spotify"),n=w(` to see
      your musicolors :)`),this.h()},l(r){e=C(r,"A",{href:!0,target:!0,class:!0,style:!0});var c=N(e);t=k(c,"log in with "),a=C(c,"SPAN",{class:!0});var g=N(a);l=k(g,"spotify"),g.forEach(h),n=k(c,` to see
      your musicolors :)`),c.forEach(h),this.h()},h(){S(a,"class","group-hover:text-green-600 group-hover:font-bold"),S(e,"href",o[5]),S(e,"target","_blank"),S(e,"class","cursor-pointer text-xl text-center font-tw group svelte-efzwv"),q(e,"width","33vh")},m(r,c){A(r,e,c),_(e,t),_(e,a),_(a,l),_(e,n)},p(r,c){c&32&&S(e,"href",r[5])},d(r){r&&h(e)}}}function ne(o){let e,t=(o[4]?"loading... wait a minute &lt;3":o[1].color)+"",a;return{c(){e=z("span"),a=w(t),this.h()},l(l){e=C(l,"SPAN",{class:!0});var n=N(e);a=k(n,t),n.forEach(h),this.h()},h(){S(e,"class","text-2xl text-center font-tw svelte-efzwv")},m(l,n){A(l,e,n),_(e,a)},p(l,n){n&18&&t!==(t=(l[4]?"loading... wait a minute &lt;3":l[1].color)+"")&&B(a,t)},d(l){l&&h(e)}}}function X(o){let e,t,a=o[2].dancable+"",l,n,r=o[2].energetic+"",c,g,b=o[2].happiness+"",I,E;return{c(){e=z("span"),t=w("your style is "),l=w(a),n=w(", "),c=w(r),g=w(" and "),I=w(b),E=w(" :)"),this.h()},l(i){e=C(i,"SPAN",{class:!0});var f=N(e);t=k(f,"your style is "),l=k(f,a),n=k(f,", "),c=k(f,r),g=k(f," and "),I=k(f,b),E=k(f," :)"),f.forEach(h),this.h()},h(){S(e,"class","absolute bottom-5 w-full text-center")},m(i,f){A(i,e,f),_(e,t),_(e,l),_(e,n),_(e,c),_(e,g),_(e,I),_(e,E)},p(i,f){f&4&&a!==(a=i[2].dancable+"")&&B(l,a),f&4&&r!==(r=i[2].energetic+"")&&B(c,r),f&4&&b!==(b=i[2].happiness+"")&&B(I,b)},d(i){i&&h(e)}}}function oe(o){let e,t,a,l,n,r,c,g,b,I,E,i=o[1]&&Q(),f=o[3],m=[];for(let s=0;s<f.length;s+=1)m[s]=W(G(o,f,s));function j(s,d){return s[0]?ne:ae}let M=j(o),y=M(o),p=o[2]&&X(o);return{c(){e=R(),t=z("h1"),a=w("musicolor"),l=R(),n=z("main"),i&&i.c(),r=R(),c=z("div");for(let s=0;s<m.length;s+=1)m[s].c();b=R(),y.c(),I=R(),p&&p.c(),E=O(),this.h()},l(s){le('[data-svelte="svelte-7uar8o"]',document.head).forEach(h),e=U(s),t=C(s,"H1",{class:!0});var u=N(t);a=k(u,"musicolor"),u.forEach(h),l=U(s),n=C(s,"MAIN",{class:!0});var x=N(n);i&&i.l(x),r=U(x),c=C(x,"DIV",{class:!0,style:!0});var T=N(c);for(let P=0;P<m.length;P+=1)m[P].l(T);T.forEach(h),b=U(x),y.l(x),x.forEach(h),I=U(s),p&&p.l(s),E=O(),this.h()},h(){document.title="musicolor",S(t,"class","text-3xl m-5 self-start justify-self-start absolute"),S(c,"class",g="overflow-hidden font-tw p-5 rounded-lg shadow-lg aspect-square"+(o[0]?"":" frame")+" svelte-efzwv"),q(c,"width","33vh"),q(c,"background",o[1]?`linear-gradient(238deg, ${o[1].color}, ${o[1].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),S(n,"class","w-full h-full flex flex-col justify-center items-center")},m(s,d){A(s,e,d),A(s,t,d),_(t,a),A(s,l,d),A(s,n,d),i&&i.m(n,null),_(n,r),_(n,c);for(let u=0;u<m.length;u+=1)m[u].m(c,null);_(n,b),y.m(n,null),A(s,I,d),p&&p.m(s,d),A(s,E,d)},p(s,[d]){if(s[1]?i||(i=Q(),i.c(),i.m(n,r)):i&&(i.d(1),i=null),d&8){f=s[3];let u;for(u=0;u<f.length;u+=1){const x=G(s,f,u);m[u]?m[u].p(x,d):(m[u]=W(x),m[u].c(),m[u].m(c,null))}for(;u<m.length;u+=1)m[u].d(1);m.length=f.length}d&1&&g!==(g="overflow-hidden font-tw p-5 rounded-lg shadow-lg aspect-square"+(s[0]?"":" frame")+" svelte-efzwv")&&S(c,"class",g),d&2&&q(c,"background",s[1]?`linear-gradient(238deg, ${s[1].color}, ${s[1].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),M===(M=j(s))&&y?y.p(s,d):(y.d(1),y=M(s),y&&(y.c(),y.m(n,null))),s[2]?p?p.p(s,d):(p=X(s),p.c(),p.m(E.parentNode,E)):p&&(p.d(1),p=null)},i:V,o:V,d(s){s&&h(e),s&&h(t),s&&h(l),s&&h(n),i&&i.d(),se(m,s),y.d(),s&&h(I),p&&p.d(s),s&&h(E)}}}function Y(o,e,t){t/=100;const a=e*Math.min(t,1-t)/100,l=n=>{const r=(n+o/30)%12,c=t-a*Math.max(Math.min(r-3,9-r,1),-1);return Math.round(255*c).toString(16).padStart(2,"0")};return`#${l(0)}${l(8)}${l(4)}`}function re(o,e,t){let a,l,n=new Array,r=!1,c,g=!1,b="https://accounts.spotify.com/authorize";b+="?response_type=token",b+="&client_id="+encodeURIComponent("e069de3022af4a738e103dfa452c80a2"),b+="&scope=user-top-read",b+="&redirect_uri="+encodeURIComponent("https://euromoon.github.io/musicolor/callback");function I(){let i=localStorage.getItem("token"),f=localStorage.getItem("expireTime");i&&f&&(console.log(Date.now(),parseInt(D.Buffer.from(f,"base64").toString())),Date.now()>parseInt(D.Buffer.from(f,"base64").toString())?localStorage.clear():(c=D.Buffer.from(i,"base64").toString(),t(0,r=!0)))}async function E(){return new Promise(i=>{F.get("https://api.spotify.com/v1/me/top/tracks?limit=25&time_range=short_term",{headers:{Authorization:"Bearer "+c,"Content-Type":"application/json"}}).then(f=>{t(3,n=f.data.items.slice(0,10).map(j=>j.name.toLowerCase()));let m=f.data.items.map(j=>j.id);F.get(`https://api.spotify.com/v1/audio-features?ids=${m.join(",")}`,{headers:{Authorization:"Bearer "+c,"Content-Type":"application/json"}}).then(j=>{let M=j.data.audio_features,y=M.map(v=>v.danceability),p=y.reduce((v,L)=>v+L,0)/y.length,s=M.map(v=>1-v.valence),d=s.reduce((v,L)=>v+L,0)/s.length;t(2,l={dancable:"",energetic:"",happiness:""});let u;p>.5&&d<.5?(u={min:40,max:115},t(2,l.dancable="dancable",l),t(2,l.happiness="happy",l)):p>.5&&d>.5?(t(2,l.dancable="dancable",l),t(2,l.happiness="emotional",l),u={min:180,max:270}):(t(2,l.dancable="calming",l),t(2,l.happiness="emotional",l),u={min:0,max:30});let x=M.map(v=>v.energy),T=x.reduce((v,L)=>v+L,0)/x.length;T>=.5?t(2,l.energetic="energetic",l):t(2,l.energetic="relaxing",l);let P=Math.round(T*(u.max-u.min)+u.min),H=M.map(v=>1-v.instrumentalness),Z=H.reduce((v,L)=>v+L,0)/H.length,J=Math.round(Z*100),K=Math.round((1-d)*100);i({color:Y(P,J,K),gradient:Y(P,J,K*.6)})})})})}return I(),window.addEventListener("storage",I),o.$$.update=()=>{o.$$.dirty&1&&r&&(t(4,g=!0),E().then(i=>{t(1,a=i),t(4,g=!1)}))},[r,a,l,n,g,b]}class ce extends ${constructor(e){super();ee(this,e,re,oe,te,{})}}export{ce as default};
