import{S as Q,i as X,s as Y,K as P,L as U,a as I,d,b as y,M as oe,f as A,I as _,J as D,e as B,t as w,c as L,g as k,h as j,N as ae,O as F,j as R,v as ne,k as G,P as re,l as V,w as ie,Q as M,x as ce,p as W,n as J,o as ue,A as fe,R as de,T as he,U as H,m as pe,V as K,W as O,X as Z,Y as me}from"../chunks/vendor-8daa988d.js";function _e(c){let e,t,l,a;return{c(){e=P("svg"),t=P("symbol"),l=P("path"),a=P("use"),this.h()},l(s){e=U(s,"svg",{class:!0});var r=I(e);t=U(r,"symbol",{id:!0,viewBox:!0});var i=I(t);l=U(i,"path",{d:!0}),I(l).forEach(d),i.forEach(d),a=U(r,"use",{"xlink:href":!0}),I(a).forEach(d),r.forEach(d),this.h()},h(){y(l,"d","M28 16h-5l-7 7-7-7h-5l-4 8v2h32v-2l-4-8zM0 28h32v2h-32v-2zM18 10v-8h-4v8h-7l9 9 9-9h-7z"),y(t,"id","icon-download"),y(t,"viewBox","0 0 32 32"),oe(a,"xlink:href","#icon-download"),y(e,"class","icon icon-download text-2xl svelte-10r85o2")},m(s,r){A(s,e,r),_(e,t),_(t,l),_(e,a)},p:D,i:D,o:D,d(s){s&&d(e)}}}class ge extends Q{constructor(e){super();X(this,e,null,_e,Y,{})}}const{document:ee}=he;function te(c,e,t){const l=c.slice();return l[10]=e[t],l[12]=t,l}function le(c){let e,t=c[10]+"",l,a,s,r;return{c(){e=B("span"),l=w(t),this.h()},l(i){e=L(i,"SPAN",{class:!0});var p=I(e);l=k(p,t),p.forEach(d),this.h()},h(){y(e,"class",a="text-2xl w-full opacity-20 text-white block "+(c[12]%2==0?"text-left":"text-right"))},m(i,p){A(i,e,p),_(e,l),r=!0},p(i,p){(!r||p&8)&&t!==(t=i[10]+"")&&j(l,t)},i(i){r||(ae(()=>{s||(s=F(e,H,{},!0)),s.run(1)}),r=!0)},o(i){s||(s=F(e,H,{},!1)),s.run(0),r=!1},d(i){i&&d(e),i&&s&&s.end()}}}function ve(c){let e,t,l,a,s;return{c(){e=B("a"),t=w("log in with "),l=B("span"),a=w("spotify"),s=w(` to see
      your musicolors :)`),this.h()},l(r){e=L(r,"A",{href:!0,target:!0,class:!0,style:!0});var i=I(e);t=k(i,"log in with "),l=L(i,"SPAN",{class:!0});var p=I(l);a=k(p,"spotify"),p.forEach(d),s=k(i,` to see
      your musicolors :)`),i.forEach(d),this.h()},h(){y(l,"class","text-green-600 font-bold"),y(e,"href",c[5]),y(e,"target","_blank"),y(e,"class","cursor-pointer text-xl text-center font-tw group"),M(e,"width","33vh")},m(r,i){A(r,e,i),_(e,t),_(e,l),_(l,a),_(e,s)},p(r,i){i&32&&y(e,"href",r[5])},d(r){r&&d(e)}}}function ye(c){let e;function t(s,r){return s[1]?we:be}let l=t(c),a=l(c);return{c(){e=B("span"),a.c(),this.h()},l(s){e=L(s,"SPAN",{class:!0,style:!0});var r=I(e);a.l(r),r.forEach(d),this.h()},h(){y(e,"class","text-3xl text-center font-tw drop-shadow mb-2"),M(e,"width","33vh")},m(s,r){A(s,e,r),a.m(e,null)},p(s,r){l===(l=t(s))&&a?a.p(s,r):(a.d(1),a=l(s),a&&(a.c(),a.m(e,null)))},d(s){s&&d(e),a.d()}}}function be(c){let e;return{c(){e=w("getting your musicolors <3")},l(t){e=k(t,"getting your musicolors <3")},m(t,l){A(t,e,l)},p:D,d(t){t&&d(e)}}}function we(c){let e,t,l,a,s=c[1].color+"",r,i,p;return{c(){e=w("the color of "),t=w(c[4]),l=w(" music is "),a=B("span"),r=w(s),this.h()},l(u){e=k(u,"the color of "),t=k(u,c[4]),l=k(u," music is "),a=L(u,"SPAN",{class:!0,style:!0});var h=I(a);r=k(h,s),h.forEach(d),this.h()},h(){y(a,"class","font-bold relaive group cursor-pointer"),M(a,"color",c[1].color)},m(u,h){A(u,e,h),A(u,t,h),A(u,l,h),A(u,a,h),_(a,r),i||(p=me(a,"click",c[6]),i=!0)},p(u,h){h&16&&j(t,u[4]),h&2&&s!==(s=u[1].color+"")&&j(r,s),h&2&&M(a,"color",u[1].color)},d(u){u&&d(e),u&&d(t),u&&d(l),u&&d(a),i=!1,p()}}}function se(c){let e,t,l=c[2].energetic+"",a,s,r=c[2].loudness+"",i,p,u=c[2].happiness+"",h,S;return{c(){e=B("span"),t=w("your style is "),a=w(l),s=w(", "),i=w(r),p=w(" and "),h=w(u),S=w(" :)"),this.h()},l(g){e=L(g,"SPAN",{class:!0});var n=I(e);t=k(n,"your style is "),a=k(n,l),s=k(n,", "),i=k(n,r),p=k(n," and "),h=k(n,u),S=k(n," :)"),n.forEach(d),this.h()},h(){y(e,"class","absolute bottom-5 w-full text-center")},m(g,n){A(g,e,n),_(e,t),_(e,a),_(e,s),_(e,i),_(e,p),_(e,h),_(e,S)},p(g,n){n&4&&l!==(l=g[2].energetic+"")&&j(a,l),n&4&&r!==(r=g[2].loudness+"")&&j(i,r),n&4&&u!==(u=g[2].happiness+"")&&j(h,u)},d(g){g&&d(e)}}}function ke(c){let e,t,l,a,s,r,i,p,u,h,S;s=new ge({});let g=c[3],n=[];for(let o=0;o<g.length;o+=1)n[o]=le(te(c,g,o));const x=o=>J(n[o],1,1,()=>{n[o]=null});function $(o,m){return o[0]?ye:ve}let E=$(c),b=E(c),v=c[2]&&se(c);return{c(){e=R(),t=B("main"),l=B("div"),a=B("div"),ne(s.$$.fragment),r=R();for(let o=0;o<n.length;o+=1)n[o].c();p=R(),b.c(),u=R(),v&&v.c(),h=G(),this.h()},l(o){re('[data-svelte="svelte-7uar8o"]',ee.head).forEach(d),e=V(o),t=L(o,"MAIN",{class:!0});var f=I(t);l=L(f,"DIV",{class:!0,style:!0});var z=I(l);a=L(z,"DIV",{class:!0});var N=I(a);ie(s.$$.fragment,N),N.forEach(d),r=V(z);for(let T=0;T<n.length;T+=1)n[T].l(z);z.forEach(d),p=V(f),b.l(f),f.forEach(d),u=V(o),v&&v.l(o),h=G(),this.h()},h(){ee.title="musicolor",y(a,"class","absolute top-2 right-2 cursor-pointer transition-opacity opacity-0 group-hover:opacity-100"),y(l,"class",i="group relative mb-5 overflow-hidden font-tw p-5 rounded-lg shadow-lg aspect-square"+(c[0]?"":" frame")+" svelte-q6zdfp"),M(l,"width","33vh"),M(l,"background",c[1]?`linear-gradient(238deg, ${c[1].color}, ${c[1].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),y(t,"class","w-full h-full flex flex-col justify-center items-center font-ttw")},m(o,m){A(o,e,m),A(o,t,m),_(t,l),_(l,a),ce(s,a,null),_(l,r);for(let f=0;f<n.length;f+=1)n[f].m(l,null);_(t,p),b.m(t,null),A(o,u,m),v&&v.m(o,m),A(o,h,m),S=!0},p(o,[m]){if(m&8){g=o[3];let f;for(f=0;f<g.length;f+=1){const z=te(o,g,f);n[f]?(n[f].p(z,m),W(n[f],1)):(n[f]=le(z),n[f].c(),W(n[f],1),n[f].m(l,null))}for(pe(),f=g.length;f<n.length;f+=1)x(f);ue()}(!S||m&1&&i!==(i="group relative mb-5 overflow-hidden font-tw p-5 rounded-lg shadow-lg aspect-square"+(o[0]?"":" frame")+" svelte-q6zdfp"))&&y(l,"class",i),(!S||m&2)&&M(l,"background",o[1]?`linear-gradient(238deg, ${o[1].color}, ${o[1].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),E===(E=$(o))&&b?b.p(o,m):(b.d(1),b=E(o),b&&(b.c(),b.m(t,null))),o[2]?v?v.p(o,m):(v=se(o),v.c(),v.m(h.parentNode,h)):v&&(v.d(1),v=null)},i(o){if(!S){W(s.$$.fragment,o);for(let m=0;m<g.length;m+=1)W(n[m]);S=!0}},o(o){J(s.$$.fragment,o),n=n.filter(Boolean);for(let m=0;m<n.length;m+=1)J(n[m]);S=!1},d(o){o&&d(e),o&&d(t),fe(s),de(n,o),b.d(),o&&d(u),v&&v.d(o),o&&d(h)}}}function Ee(c,e,t){let l,a,s=new Array,r=!1,i,p,u="https://accounts.spotify.com/authorize";u+="?response_type=token",u+="&client_id="+encodeURIComponent("e069de3022af4a738e103dfa452c80a2"),u+="&scope=user-top-read",u+="&redirect_uri="+encodeURIComponent("https://euromoon.github.io/musicolor/callback");function h(){let n=localStorage.getItem("token"),x=localStorage.getItem("expireTime");n&&x&&(console.log(Date.now(),parseInt(K.Buffer.from(x,"base64").toString())),Date.now()>parseInt(K.Buffer.from(x,"base64").toString())?localStorage.clear():(i=K.Buffer.from(n,"base64").toString(),t(0,r=!0)))}async function S(){return new Promise(n=>{O.get("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"}}).then(x=>{t(4,p=x.data.display_name+"'"),p.endsWith("s")||t(4,p+="s")}),O.get("https://api.spotify.com/v1/me/top/tracks?limit=15&time_range=short_term",{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"}}).then(x=>{t(3,s=x.data.items.slice(0,10).map(E=>E.name.toLowerCase()));let $=x.data.items.map(E=>E.id);O.get(`https://api.spotify.com/v1/audio-features?ids=${$.join(",")}`,{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"}}).then(E=>{let b=E.data.audio_features,v=b.map(C=>C.energy),o=v.reduce((C,q)=>C+q,0)/v.length,m=b.map(C=>(C.loudness+60)/60),f=m.reduce((C,q)=>C+q,0)/m.length,z=b.map(C=>1-C.valence),N=z.reduce((C,q)=>C+q,0)/z.length,T=Math.round(o*360);t(2,a={loudness:f>=.5?"loud":"quiet",energetic:N<=.5?"happy":"melancholic",happiness:o>=.5?"energetic":"chill"}),n({color:Z.hsl(T,f,N).hex(),gradient:Z.hsl(T,f,N*.6).hex()})})})})}function g(n){navigator.clipboard.writeText(l.color);let x=n.target,$=document.createElement("span"),E={x:Math.random()*100,y:(Math.random()*1.5-1)*100};$.classList.add("text-xl","rounded","absolute","p-1","text-white","left-1/2"),$.textContent="copied!",x.appendChild($),$.animate([{opacity:1,transform:`translate(${E.x}%, ${E.y}%)`},{opacity:0,transform:`translate(${E.x}%, ${E.y+10}%)`}],{duration:500,easing:"ease-in-out"}).addEventListener("finish",()=>$.remove())}return h(),window.addEventListener("storage",h),c.$$.update=()=>{c.$$.dirty&1&&r&&S().then(n=>{t(1,l=n)})},[r,l,a,s,p,u,g]}class Ie extends Q{constructor(e){super();X(this,e,Ee,ke,Y,{})}}export{Ie as default};
