import{S as X,i as Y,s as Z,e as M,t as g,c as z,a as N,g as b,d as u,b as k,f as I,I as p,h as B,j as P,k as V,K as $,l as T,L,J as U,M as q,N as ee,O as F}from"../chunks/vendor-d8275c28.js";function G(r){let e,t;return{c(){e=M("span"),t=g("your musicolor is:"),this.h()},l(a){e=z(a,"SPAN",{class:!0});var n=N(e);t=b(n,"your musicolor is:"),n.forEach(u),this.h()},h(){k(e,"class","text-3xl text-center font-tw drop-shadow mb-2 svelte-efzwv")},m(a,n){I(a,e,n),p(e,t)},d(a){a&&u(e)}}}function te(r){let e,t,a,n,s;return{c(){e=M("a"),t=g("log in with "),a=M("span"),n=g("spotify"),s=g(` to see
      your musicolors :)`),this.h()},l(f){e=z(f,"A",{href:!0,target:!0,class:!0,style:!0});var o=N(e);t=b(o,"log in with "),a=z(o,"SPAN",{class:!0});var m=N(a);n=b(m,"spotify"),m.forEach(u),s=b(o,` to see
      your musicolors :)`),o.forEach(u),this.h()},h(){k(a,"class","group-hover:text-green-600 group-hover:font-bold"),k(e,"href",r[5]),k(e,"target","_blank"),k(e,"class","cursor-pointer text-xl text-center font-tw group svelte-efzwv"),L(e,"width","33vh")},m(f,o){I(f,e,o),p(e,t),p(e,a),p(a,n),p(e,s)},p(f,o){o&32&&k(e,"href",f[5])},d(f){f&&u(e)}}}function se(r){let e,t=r[2].color+"",a;return{c(){e=M("span"),a=g(t),this.h()},l(n){e=z(n,"SPAN",{class:!0});var s=N(e);a=b(s,t),s.forEach(u),this.h()},h(){k(e,"class","text-2xl text-center font-tw svelte-efzwv")},m(n,s){I(n,e,s),p(e,a)},p(n,s){s&4&&t!==(t=n[2].color+"")&&B(a,t)},d(n){n&&u(e)}}}function le(r){let e,t;return{c(){e=M("span"),t=g("loading... wait a minute <3")},l(a){e=z(a,"SPAN",{});var n=N(e);t=b(n,"loading... wait a minute <3"),n.forEach(u)},m(a,n){I(a,e,n),p(e,t)},p:U,d(a){a&&u(e)}}}function Q(r){let e,t,a=r[3].dancable+"",n,s,f=r[3].energetic+"",o,m,_=r[3].happiness+"",v,w;return{c(){e=M("span"),t=g("your style is "),n=g(a),s=g(", "),o=g(f),m=g(" and "),v=g(_),w=g(" :)"),this.h()},l(i){e=z(i,"SPAN",{class:!0});var c=N(e);t=b(c,"your style is "),n=b(c,a),s=b(c,", "),o=b(c,f),m=b(c," and "),v=b(c,_),w=b(c," :)"),c.forEach(u),this.h()},h(){k(e,"class","absolute bottom-5 w-full text-center")},m(i,c){I(i,e,c),p(e,t),p(e,n),p(e,s),p(e,o),p(e,m),p(e,v),p(e,w)},p(i,c){c&8&&a!==(a=i[3].dancable+"")&&B(n,a),c&8&&f!==(f=i[3].energetic+"")&&B(o,f),c&8&&_!==(_=i[3].happiness+"")&&B(v,_)},d(i){i&&u(e)}}}function ae(r){let e,t,a,n,s,f,o,m,_,v,w,i=r[2]&&G();function c(l,h){return l[4]?le:l[0]?se:te}let E=c(r),y=E(r),d=r[3]&&Q(r);return{c(){e=P(),t=M("h1"),a=g("musicolor"),n=P(),s=M("main"),i&&i.c(),f=P(),o=M("div"),_=P(),y.c(),v=P(),d&&d.c(),w=V(),this.h()},l(l){$('[data-svelte="svelte-7uar8o"]',document.head).forEach(u),e=T(l),t=z(l,"H1",{class:!0});var j=N(t);a=b(j,"musicolor"),j.forEach(u),n=T(l),s=z(l,"MAIN",{class:!0});var A=N(s);i&&i.l(A),f=T(A),o=z(A,"DIV",{class:!0,style:!0}),N(o).forEach(u),_=T(A),y.l(A),A.forEach(u),v=T(l),d&&d.l(l),w=V(),this.h()},h(){document.title="musicolor",k(t,"class","text-3xl m-5 self-start justify-self-start absolute"),k(o,"class",m="rounded-lg shadow-lg aspect-square"+(r[0]?"":" frame")+" svelte-efzwv"),L(o,"width","33vh"),L(o,"background",r[2]?`linear-gradient(238deg, ${r[2].color}, ${r[2].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),k(s,"class","w-full h-full flex flex-col justify-center items-center")},m(l,h){I(l,e,h),I(l,t,h),p(t,a),I(l,n,h),I(l,s,h),i&&i.m(s,null),p(s,f),p(s,o),r[6](o),p(s,_),y.m(s,null),I(l,v,h),d&&d.m(l,h),I(l,w,h)},p(l,[h]){l[2]?i||(i=G(),i.c(),i.m(s,f)):i&&(i.d(1),i=null),h&1&&m!==(m="rounded-lg shadow-lg aspect-square"+(l[0]?"":" frame")+" svelte-efzwv")&&k(o,"class",m),h&4&&L(o,"background",l[2]?`linear-gradient(238deg, ${l[2].color}, ${l[2].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),E===(E=c(l))&&y?y.p(l,h):(y.d(1),y=E(l),y&&(y.c(),y.m(s,null))),l[3]?d?d.p(l,h):(d=Q(l),d.c(),d.m(w.parentNode,w)):d&&(d.d(1),d=null)},i:U,o:U,d(l){l&&u(e),l&&u(t),l&&u(n),l&&u(s),i&&i.d(),r[6](null),y.d(),l&&u(v),d&&d.d(l),l&&u(w)}}}function W(r,e,t){t/=100;const a=e*Math.min(t,1-t)/100,n=s=>{const f=(s+r/30)%12,o=t-a*Math.max(Math.min(f-3,9-f,1),-1);return Math.round(255*o).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}function ne(r,e,t){let a,n,s,f=!1,o,m=!1,_="https://accounts.spotify.com/authorize";_+="?response_type=token",_+="&client_id="+encodeURIComponent("e069de3022af4a738e103dfa452c80a2"),_+="&scope=user-top-read",_+="&redirect_uri="+encodeURIComponent("https://euromoon.github.io/musicolor/callback");function v(){let c=localStorage.getItem("token"),E=localStorage.getItem("expireTime");c&&E&&(console.log(Date.now(),parseInt(q.Buffer.from(E,"base64").toString())),Date.now()>parseInt(q.Buffer.from(E,"base64").toString())?localStorage.clear():(o=q.Buffer.from(c,"base64").toString(),t(0,f=!0)))}async function w(){return new Promise(c=>{F.get("https://api.spotify.com/v1/me/top/tracks?limit=25&time_range=short_term",{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}}).then(E=>{let y=E.data.items.map(d=>d.id);F.get(`https://api.spotify.com/v1/audio-features?ids=${y.join(",")}`,{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}}).then(d=>{let l=d.data.audio_features,h=l.map(S=>S.danceability),j=h.reduce((S,C)=>S+C,0)/h.length,A=l.map(S=>1-S.valence),R=A.reduce((S,C)=>S+C,0)/A.length;t(3,s={dancable:"",energetic:"",happiness:""});let x;j>.5&&R<.5?(x={min:40,max:115},t(3,s.dancable="dancable",s),t(3,s.happiness="happy",s)):j>.5&&R>.5?(t(3,s.dancable="dancable",s),t(3,s.happiness="emotional",s),x={min:180,max:270}):(t(3,s.dancable="calming",s),t(3,s.happiness="emotional",s),x={min:0,max:30});let D=l.map(S=>S.energy),H=D.reduce((S,C)=>S+C,0)/D.length;H>=.5?t(3,s.energetic="energetic",s):t(3,s.energetic="relaxing",s);let J=Math.round(H*(x.max-x.min)+x.min),K=Math.round(j*100),O=Math.round((1-R)*100);c({color:W(J,K,O),gradient:W(J,K,O*.6)})})})})}v(),window.addEventListener("storage",v);function i(c){ee[c?"unshift":"push"](()=>{a=c,t(1,a)})}return r.$$.update=()=>{r.$$.dirty&1&&f&&(t(4,m=!0),w().then(c=>{t(2,n=c),t(4,m=!1)}))},[f,a,n,s,m,_,i]}class re extends X{constructor(e){super();Y(this,e,ne,ae,Z,{})}}export{re as default};
