import{S as H,i as ee,s as te,K as $,L as W,a as x,d,b as g,M as fe,f as N,I as _,J as F,e as P,t as A,j as M,c as z,g as S,l as T,N as J,O as pe,h as U,P as de,Q as le,v as he,k as se,R as me,w as _e,T as j,x as ge,p as K,n as Q,o as ve,A as ye,U as be,V as we,W as ae,m as ke,X,Y,Z as oe}from"../chunks/vendor-8d342ccb.js";function Ee(n){let e,t,a,l;return{c(){e=$("svg"),t=$("symbol"),a=$("path"),l=$("use"),this.h()},l(o){e=W(o,"svg",{class:!0});var s=x(e);t=W(s,"symbol",{id:!0,viewBox:!0});var i=x(t);a=W(i,"path",{d:!0}),x(a).forEach(d),i.forEach(d),l=W(s,"use",{"xlink:href":!0}),x(l).forEach(d),s.forEach(d),this.h()},h(){g(a,"d","M28 16h-5l-7 7-7-7h-5l-4 8v2h32v-2l-4-8zM0 28h32v2h-32v-2zM18 10v-8h-4v8h-7l9 9 9-9h-7z"),g(t,"id","icon-download"),g(t,"viewBox","0 0 32 32"),fe(l,"xlink:href","#icon-download"),g(e,"class","icon icon-download text-2xl svelte-10r85o2")},m(o,s){N(o,e,s),_(e,t),_(t,a),_(e,l)},p:F,i:F,o:F,d(o){o&&d(e)}}}class Ae extends H{constructor(e){super();ee(this,e,null,Ee,te,{})}}const{document:re}=we;function ne(n,e,t){const a=n.slice();return a[13]=e[t],a[15]=t,a}function ie(n){let e,t,a,l,o,s,i,h,u,c,E,b,f,B;return{c(){e=P("div"),t=P("span"),a=A("last month"),o=M(),s=P("span"),i=A("last 6 months"),u=M(),c=P("span"),E=A("all time"),this.h()},l(p){e=z(p,"DIV",{class:!0});var v=x(e);t=z(v,"SPAN",{"data-range":!0,class:!0});var C=x(t);a=S(C,"last month"),C.forEach(d),o=T(v),s=z(v,"SPAN",{"data-range":!0,class:!0});var I=x(s);i=S(I,"last 6 months"),I.forEach(d),u=T(v),c=z(v,"SPAN",{"data-range":!0,class:!0});var k=x(c);E=S(k,"all time"),k.forEach(d),v.forEach(d),this.h()},h(){g(t,"data-range","0"),g(t,"class",l="transition-colors py-1 px-3"+(n[1]==0?" bg-white text-slate-900":"")+" rounded-l cursor-pointer"),g(s,"data-range","1"),g(s,"class",h="transition-colors py-1 px-3"+(n[1]==1?" bg-white text-slate-900":"")+" cursor-pointer"),g(c,"data-range","2"),g(c,"class",b="transition-colors py-1 px-3"+(n[1]==2?" bg-white text-slate-900":"")+" rounded-r cursor-pointer"),g(e,"class","absolute top-5")},m(p,v){N(p,e,v),_(e,t),_(t,a),_(e,o),_(e,s),_(s,i),_(e,u),_(e,c),_(c,E),f||(B=[J(t,"click",n[8]),J(s,"click",n[8]),J(c,"click",n[8])],f=!0)},p(p,v){v&2&&l!==(l="transition-colors py-1 px-3"+(p[1]==0?" bg-white text-slate-900":"")+" rounded-l cursor-pointer")&&g(t,"class",l),v&2&&h!==(h="transition-colors py-1 px-3"+(p[1]==1?" bg-white text-slate-900":"")+" cursor-pointer")&&g(s,"class",h),v&2&&b!==(b="transition-colors py-1 px-3"+(p[1]==2?" bg-white text-slate-900":"")+" rounded-r cursor-pointer")&&g(c,"class",b)},d(p){p&&d(e),f=!1,pe(B)}}}function ce(n){let e,t=n[13]+"",a,l,o,s;return{c(){e=P("span"),a=A(t),this.h()},l(i){e=z(i,"SPAN",{class:!0});var h=x(e);a=S(h,t),h.forEach(d),this.h()},h(){g(e,"class",l="text-2xl w-full opacity-20 text-white block "+(n[15]%2==0?"text-left":"text-right"))},m(i,h){N(i,e,h),_(e,a),s=!0},p(i,h){(!s||h&16)&&t!==(t=i[13]+"")&&U(a,t)},i(i){s||(de(()=>{o||(o=le(e,ae,{},!0)),o.run(1)}),s=!0)},o(i){o||(o=le(e,ae,{},!1)),o.run(0),s=!1},d(i){i&&d(e),i&&o&&o.end()}}}function Se(n){let e,t,a,l,o;return{c(){e=P("a"),t=A("log in with "),a=P("span"),l=A("spotify"),o=A(` to see
      your musicolors :)`),this.h()},l(s){e=z(s,"A",{href:!0,target:!0,class:!0,style:!0});var i=x(e);t=S(i,"log in with "),a=z(i,"SPAN",{class:!0});var h=x(a);l=S(h,"spotify"),h.forEach(d),o=S(i,` to see
      your musicolors :)`),i.forEach(d),this.h()},h(){g(a,"class","text-green-600 font-bold"),g(e,"href",n[6]),g(e,"target","_blank"),g(e,"class","cursor-pointer text-xl text-center font-tw group"),j(e,"width","33vh")},m(s,i){N(s,e,i),_(e,t),_(e,a),_(a,l),_(e,o)},p(s,i){i&64&&g(e,"href",s[6])},d(s){s&&d(e)}}}function Ie(n){let e;function t(o,s){return o[2]?Ce:xe}let a=t(n),l=a(n);return{c(){e=P("span"),l.c(),this.h()},l(o){e=z(o,"SPAN",{class:!0,style:!0});var s=x(e);l.l(s),s.forEach(d),this.h()},h(){g(e,"class","text-3xl text-center font-tw drop-shadow mb-2"),j(e,"width","33vh")},m(o,s){N(o,e,s),l.m(e,null)},p(o,s){a===(a=t(o))&&l?l.p(o,s):(l.d(1),l=a(o),l&&(l.c(),l.m(e,null)))},d(o){o&&d(e),l.d()}}}function xe(n){let e;return{c(){e=A("getting your musicolors <3")},l(t){e=S(t,"getting your musicolors <3")},m(t,a){N(t,e,a)},p:F,d(t){t&&d(e)}}}function Ce(n){let e,t,a,l,o=n[2].color+"",s,i,h;return{c(){e=A("the color of "),t=A(n[5]),a=A(" music is "),l=P("span"),s=A(o),this.h()},l(u){e=S(u,"the color of "),t=S(u,n[5]),a=S(u," music is "),l=z(u,"SPAN",{class:!0,style:!0});var c=x(l);s=S(c,o),c.forEach(d),this.h()},h(){g(l,"class","font-bold relaive group cursor-pointer"),j(l,"color",n[2].color)},m(u,c){N(u,e,c),N(u,t,c),N(u,a,c),N(u,l,c),_(l,s),i||(h=J(l,"click",n[7]),i=!0)},p(u,c){c&32&&U(t,u[5]),c&4&&o!==(o=u[2].color+"")&&U(s,o),c&4&&j(l,"color",u[2].color)},d(u){u&&d(e),u&&d(t),u&&d(a),u&&d(l),i=!1,h()}}}function ue(n){let e,t,a=n[3].energetic+"",l,o,s=n[3].loudness+"",i,h,u=n[3].happiness+"",c,E;return{c(){e=P("span"),t=A("your style is "),l=A(a),o=A(", "),i=A(s),h=A(" and "),c=A(u),E=A(" :)"),this.h()},l(b){e=z(b,"SPAN",{class:!0});var f=x(e);t=S(f,"your style is "),l=S(f,a),o=S(f,", "),i=S(f,s),h=S(f," and "),c=S(f,u),E=S(f," :)"),f.forEach(d),this.h()},h(){g(e,"class","absolute bottom-5 w-full text-center")},m(b,f){N(b,e,f),_(e,t),_(e,l),_(e,o),_(e,i),_(e,h),_(e,c),_(e,E)},p(b,f){f&8&&a!==(a=b[3].energetic+"")&&U(l,a),f&8&&s!==(s=b[3].loudness+"")&&U(i,s),f&8&&u!==(u=b[3].happiness+"")&&U(c,u)},d(b){b&&d(e)}}}function Ne(n){let e,t,a,l,o,s,i,h,u,c,E,b,f=n[2]&&ie(n);s=new Ae({});let B=n[4],p=[];for(let r=0;r<B.length;r+=1)p[r]=ce(ne(n,B,r));const v=r=>Q(p[r],1,1,()=>{p[r]=null});function C(r,y){return r[0]?Ie:Se}let I=C(n),k=I(n),w=n[3]&&ue(n);return{c(){e=M(),t=P("main"),f&&f.c(),a=M(),l=P("div"),o=P("div"),he(s.$$.fragment),i=M();for(let r=0;r<p.length;r+=1)p[r].c();u=M(),k.c(),c=M(),w&&w.c(),E=se(),this.h()},l(r){me('[data-svelte="svelte-7uar8o"]',re.head).forEach(d),e=T(r),t=z(r,"MAIN",{class:!0});var m=x(t);f&&f.l(m),a=T(m),l=z(m,"DIV",{class:!0,style:!0});var L=x(l);o=z(L,"DIV",{class:!0});var q=x(o);_e(s.$$.fragment,q),q.forEach(d),i=T(L);for(let R=0;R<p.length;R+=1)p[R].l(L);L.forEach(d),u=T(m),k.l(m),m.forEach(d),c=T(r),w&&w.l(r),E=se(),this.h()},h(){re.title="musicolor",g(o,"class","absolute top-2 right-2 cursor-pointer transition-opacity opacity-0 group-hover:opacity-100"),g(l,"class",h="group relative mb-5 overflow-hidden font-tw p-5 rounded-lg shadow-lg aspect-square"+(n[0]?"":" frame")+" svelte-q6zdfp"),j(l,"width","33vh"),j(l,"background",n[2]?`linear-gradient(238deg, ${n[2].color}, ${n[2].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),g(t,"class","w-full h-full flex flex-col justify-center items-center font-ttw")},m(r,y){N(r,e,y),N(r,t,y),f&&f.m(t,null),_(t,a),_(t,l),_(l,o),ge(s,o,null),_(l,i);for(let m=0;m<p.length;m+=1)p[m].m(l,null);_(t,u),k.m(t,null),N(r,c,y),w&&w.m(r,y),N(r,E,y),b=!0},p(r,[y]){if(r[2]?f?f.p(r,y):(f=ie(r),f.c(),f.m(t,a)):f&&(f.d(1),f=null),y&16){B=r[4];let m;for(m=0;m<B.length;m+=1){const L=ne(r,B,m);p[m]?(p[m].p(L,y),K(p[m],1)):(p[m]=ce(L),p[m].c(),K(p[m],1),p[m].m(l,null))}for(ke(),m=B.length;m<p.length;m+=1)v(m);ve()}(!b||y&1&&h!==(h="group relative mb-5 overflow-hidden font-tw p-5 rounded-lg shadow-lg aspect-square"+(r[0]?"":" frame")+" svelte-q6zdfp"))&&g(l,"class",h),(!b||y&4)&&j(l,"background",r[2]?`linear-gradient(238deg, ${r[2].color}, ${r[2].gradient})`:"linear-gradient(238deg, #9700fd, #003dfd)"),I===(I=C(r))&&k?k.p(r,y):(k.d(1),k=I(r),k&&(k.c(),k.m(t,null))),r[3]?w?w.p(r,y):(w=ue(r),w.c(),w.m(E.parentNode,E)):w&&(w.d(1),w=null)},i(r){if(!b){K(s.$$.fragment,r);for(let y=0;y<B.length;y+=1)K(p[y]);b=!0}},o(r){Q(s.$$.fragment,r),p=p.filter(Boolean);for(let y=0;y<p.length;y+=1)Q(p[y]);b=!1},d(r){r&&d(e),r&&d(t),f&&f.d(),ye(s),be(p,r),k.d(),r&&d(c),w&&w.d(r),r&&d(E)}}}function Pe(n){switch(n){case 0:return"short_term";case 1:return"medium_term";case 2:return"long_term"}}function ze(n,e,t){let a=new Array,l,o,s=new Array,i=!1,h,u,c=2,E="https://accounts.spotify.com/authorize";E+="?response_type=token",E+="&client_id="+encodeURIComponent("e069de3022af4a738e103dfa452c80a2"),E+="&scope=user-top-read",E+="&redirect_uri="+encodeURIComponent("https://euromoon.github.io/musicolor/callback");function b(){let v=localStorage.getItem("token"),C=localStorage.getItem("expireTime");v&&C&&(console.log(Date.now(),parseInt(X.Buffer.from(C,"base64").toString())),Date.now()>parseInt(X.Buffer.from(C,"base64").toString())?localStorage.clear():(h=X.Buffer.from(v,"base64").toString(),t(0,i=!0)))}async function f(v){return new Promise(C=>{Y.get("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}}).then(I=>{t(5,u=I.data.display_name+"'"),u.endsWith("s")||t(5,u+="s")}),Y.get(`https://api.spotify.com/v1/me/top/tracks?limit=15&time_range=${Pe(v)}`,{headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}}).then(I=>{t(4,s=I.data.items.slice(0,10).map(w=>w.name.toLowerCase()));let k=I.data.items.map(w=>w.id);Y.get(`https://api.spotify.com/v1/audio-features?ids=${k.join(",")}`,{headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}}).then(w=>{let r=w.data.audio_features,y=r.map(D=>D.energy),m=y.reduce((D,V)=>D+V,0)/y.length,L=r.map(D=>(D.loudness+60)/60),q=L.reduce((D,V)=>D+V,0)/L.length,R=r.map(D=>1-D.valence),O=R.reduce((D,V)=>D+V,0)/R.length,Z=Math.round((1-m)*360),G={color:oe.hsl(Z,q,O).hex(),gradient:oe.hsl(Z,q,O*.6).hex()};t(3,o={loudness:q>=.5?"loud":"quiet",energetic:O<=.5?"happy":"melancholic",happiness:m>=.5?"energetic":"chill"}),t(9,a[v]={colorData:G,songs:s,musicStyle:o},a),C(G)})})})}function B(v){navigator.clipboard.writeText(l.color);let C=v.target,I=document.createElement("span"),k={x:Math.random()*100,y:(Math.random()*1.5-1)*100};I.classList.add("text-xl","rounded","absolute","p-1","text-white","left-1/2"),I.textContent="copied!",C.appendChild(I),I.animate([{opacity:1,transform:`translate(${k.x}%, ${k.y}%)`},{opacity:0,transform:`translate(${k.x}%, ${k.y+10}%)`}],{duration:500,easing:"ease-in-out"}).addEventListener("finish",()=>I.remove())}function p(v){let C=v.target;t(1,c=parseInt(C.getAttribute("data-range")))}return b(),window.addEventListener("storage",b),n.$$.update=()=>{n.$$.dirty&515&&i&&c!=null&&(a[c]!=null?(t(2,l=a[c].colorData),t(4,s=a[c].songs),t(3,o=a[c].musicStyle)):f(c).then(v=>{t(2,l=v)}))},[i,c,l,o,s,u,E,B,p,a]}class De extends H{constructor(e){super();ee(this,e,ze,Ne,te,{})}}export{De as default};
